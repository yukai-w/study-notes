# diff

diff作为virtual DOM 的加速器, 其算法上的改进优化是React整个界面渲染的基础和性能的保障, 同时也是React源码中最神秘,最不可思议的部分.

> Virtual DOM 模型与diff是保证React性能口碑的幕后推手.

## 传统diff算法

计算一棵树形结构转换成另一棵树形结构的最少操作, 是一个复杂且值得研究的问题.

传统的diff算法通过`循环递归`对节点进行一次对比, 效率低下

## 详解diff

React将Virtual DOM树转换成actual DOM树的最少操作的过程称为`调和(reconciliation)`.

> React通过制定大胆的策略, 将O(n^3)复杂度的问题转换成O(n)复杂度的问题.

### diff策略

1. Web UI中DOM节点跨层级的移动操作特别少, 可以忽略不计.
2. 拥有相同类的两个组件将生成相似的树形结构, 拥有不同类的两个组件将会生成不同的树形结构.
3. 对于同一层级的一组子节点, 它们可以通过唯一id进行区分.

### tree diff

基于策略一, React对树的算法进行了简洁明了的优化, 即对树进行分层比较, 两棵树只会`对同一层次的节点进行比较`.

> 在开发组件的时候, 保持稳定的DOM结构会有助于性能的提升. 例如: 可以通过css隐藏或显示节点, 而不是真正地移除或添加DOM节点.

